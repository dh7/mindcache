name = "mindcache-api"
main = "src/worker.ts"
compatibility_date = "2024-11-01"
compatibility_flags = ["nodejs_compat"]

# Durable Objects
[durable_objects]
bindings = [
  { name = "MINDCACHE_INSTANCE", class_name = "MindCacheInstanceDO" }
]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "mindcache-db"
database_id = "29e53281-6ad2-4c90-b7de-27d55fcad594"
migrations_dir = "migrations"

# Migrations
[[ migrations ]]
tag = "v1"
new_sqlite_classes = ["MindCacheInstanceDO"]

# Environment variables (default = development for wrangler dev)
[vars]
ENVIRONMENT = "development"

# Production environment - used by wrangler deploy
[env.production]
[env.production.vars]
ENVIRONMENT = "production"

[env.production.durable_objects]
bindings = [
  { name = "MINDCACHE_INSTANCE", class_name = "MindCacheInstanceDO" }
]

[[env.production.d1_databases]]
binding = "DB"
database_name = "mindcache-db"
database_id = "29e53281-6ad2-4c90-b7de-27d55fcad594"
migrations_dir = "migrations"

# Secrets (set via wrangler secret put):
# - CLERK_SECRET_KEY
# - CLERK_WEBHOOK_SECRET
# - OPENAI_API_KEY
# - FIREWORKS_API_KEY
# - ADMIN_TOKEN
